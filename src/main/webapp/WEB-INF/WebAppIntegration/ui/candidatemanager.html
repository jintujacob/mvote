
<style>

span{   
     float:left;
     min-height:200px;  
}

#panelLeftHomePage{
       width: 250px;
    }
    
    
    #panelLeftHomePage button{
       padding:3px 5px 3px 5px;
       width: 200px;
       background-color:white;
       border-top : 1px solid #ccc;
       border-right : 1px solid #ccc;
       border-bottom : 1px solid black;
       border-left : 1px solid black;
       margin-bottom: 20px;
    }
    
    #panelLeftHomePage button:hover{
            background-color:#A9A9F5;
    }
    
    #panelLeftHomePage button:clicked{
            background-color:#A9A9F5;
    }
    
    #panelRightHomePage{
        padding-left: 20px;
        border-left: 1px solid black;
    }

    

#pageCandidateListView td{
    border:1px solid #ccc;
    padding: 5px;
    margin : 3px;
}

    #pageCandidateListView a{
        display: block;
        padding:3px;
        border:1px solid blue;
    }
    
        #pageCandidateListView a:hover{
            border:1px solid red;
        }
        
        #pageCandidateListView a:active{
            background:#ccc;
        }
        
#pageCandidateListView{
       overflow:auto;
    }
    
#btn_submit_search{
       width: 100px;
       padding: 2px 20px 2px 20px;
}    

#btn_add_cand{
       width: 100px;
       padding: 2px 20px 2px 20px;
}    


select{
    min-width: 150px;
}

.input_error_msg{
    color:red;
}

#pageCandidateListView table{
    width: 100%;
}


#pageCandidateListView thead td{
        border: 1px solid black;
        padding: 2px 2px 2px 4px;
        background: #819FF7;
        font-family: Verdana;
        font-size: 13px;
        
}
    
#pageCandidateListView tbody td{
        border-bottom:1px solid #ccc;
        padding-left: 4px;
        font-family: Verdana;
        font-size: 13px;
}

.btn_backto_home{
        width: 200px;
        float:right;
        border: 1px solid blue;
        padding: 2px 5px 2px 5px;
        text-align: center;   
    }   
    
#tableCandidateDetail{
    float:left;
    width: 600px;
    border : 1px solid black;
    padding: 5px
}    

#tableCandidateDetail td{
    padding: 2px;
    border-bottom: 1px solid #ccc;
}    

#divOperations{
    padding-left : 100px;
    float:left;
}

#buttonArea button{
      padding:4px 5px 4px 5px;
       width: 150px;
       background-color:#585858;
       color:white;
       margin-bottom: 50px;
}

</style>


<div id="container">
    <div class="dataContainerHeading">
            <b>Candidate Management</b>
            <hr/>
     </div>
     
     <p class="dataContainerDescription">
            Candidate management includes setting up the candidates, searching and updating the details 
            of the candidates.  
     </p> 
     
    <div id="pageCandidateManagerHome">
       <span id="panelLeftHomePage">
           <p> 
                <button id="goto_search_cand"> Search </button> <br/>
                <button id="goto_add_cand"> Add New </button>         
           </p>
       </span>
    
       <span id="panelRightHomePage">
            <div id="contentSearchCandForm">
		            <p class="containerSubHeading">
		                <b> Search Candidates</b>
		            </p>

                    <table>
                        <tr> 
                            <td align='right'> Candidate Name :</td>
                            <td> <input type="text" id="in_srch_candname"> <br></td>
                        </tr>
                        <tr> 
                            <td align='right'>Constituency :</td>
                            <td> <select id="in_srch_candconst">   <!--  ajax it --> </select>  </td>
                        </tr>
                        <tr> 
                            <td> </td>
                            <td>
                                <br><br>
                                <p class="input_error_msg">  <!-- ajax it  --></p>
                                <button id="btn_submit_search"> Find </button>
                            </td>
                        </tr>
                    </table>
            </div>
           <div id="contentAddCandForm">
                    <p class="containerSubHeading">
                        <b> Add new Candidate</b>
                    </p>
                    
                   Constituency : <select id="in_add_consts"> <!--  ajax it  --></select>    <br><br>    
                   Election : <select id="in_add_eles"> <!--  ajax it  --> </select>    <br><br>
                   Name:   <input type="text" id="in_add_name"> <br><br>
                   Details:   <input type="text" id="in_add_bio"> <br><br>
                      
                   
                   <p class="input_error_msg">  <!-- ajax it  --></p>
                   <button id="btn_add_cand"> Register </button>
                   
           </div>
       </span>
    </div>
    
    <div id="pageCandidateListView">
        <div class="btn_backto_home"> Candidate Home </div>
         <p class="containerSubHeading">
            <b> Search Results</b>
        </p>  
        <table id="tableCandidateList">
            <thead>
                <tr> <td>Candidate ID</td> <td>Name </td>  <td>Election</td> <td>Constituency</td> </tr>
            </thead>
            <tbody> <!-- ajax it --> </tbody>
        </table>
    </div>
    
    <div id="pageCandDetailView">
           <div class="btn_backto_home"> Candidate Home </div>
           <p class="containerSubHeading">
                <b> Candidate Detail</b>
           </p>
           <table id="tableCandidateDetail">  <!-- ajax it  -->  </table>
           
           <div id="divOperations">
                <div class="tableHeadingInSpan"> 
                    Manage Candidate
                </div>
                <br>
                <p id="buttonArea"> 
	                <!-- ajax it --> 
	            </p>
	       </div>
               
           </div>
    </div>
</div>    


<script type="text/javascript">

constsDropDownContent = "";
candidatResults = "";


$(document).ready(function(){
    getHomeContents();
    populateHomePage();
    
    
    $('#goto_search_cand').click(function(){
         $('#contentAddCandForm').hide();
         $('#contentSearchCandForm').show();
    });
     
    $('#goto_add_cand').click(function(){
         $('#contentSearchCandForm').hide();
         $('#contentAddCandForm').show();
         
    });
     
    $('#btn_submit_search').click(function()
    {
        name = $('#in_srch_candname').val();
        constituency = $('#in_srch_candconst').val();
        
        if(name != "" || constituency != ""){
            constituency = (constituency == 'none' )? "":constituency;
            console.log(name, constituency);
            processCandidateSearch(name, constituency );
        }
    });
    
    $('#btn_add_cand').click(function()
    {
        name = $('#in_add_name').val();
        bio = $('#in_add_bio').val();
        unitId = $('#in_add_eles').val();

        if(name != "" && bio != "" && unitId != "none" && unitId !=""){
            addNewCandidate(name, bio, unitId);
        }
        else{
            $('.input_error_msg').html("All fields are mandatory");
        }
    });
    
    $('.btn_backto_home').click(function(){
        populateHomeConstsDropDown();
    });
    
    $('.btn_backto_reslt').click(function(){
        populateCandidateList(searchResult);
    });
    
    
    $("#in_add_consts").change(function() {
        constId = $(this).val();
        if(constId != "none"){
            getElectionsByConstituency(constId);
        }
        
    });
    
});


function addNewCandidate(name, bio, unitId)
{
    obj = { "candName": name,
            "candBio": bio,
            "unitEleId" : unitId
        };
    jsonString =JSON.stringify(obj);
    
    $.ajax({
        type: "POST",
        url: 'http://localhost:8080/mvote/candidates/addNewCandidate',
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data: jsonString,
        success: function(response) {
            populateAdditionResponse(response);
        },
        error:function(){
            alert("Connection Error. Network failure or Server unavailable");
        }
    });     
}

function populateAdditionResponse(response){
	if(response.customMessage == "SUCCES"){
		alert("Successfully added candidate to the system");
		populateHomePage();
		
	}else{
		alert(response.customMessage);
		populateHomePage();
	}
	
}


function processCandidateSearch(name, constituency )
{
    obj = { "candName":name,
            "constName":constituency 
        };
    jsonString =JSON.stringify(obj);
    
    $.ajax({
        type: "POST",
        url: 'http://localhost:8080/mvote/candidates/searchCandidate',
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data: jsonString,
        success: function(response) {
            candidatResults = response.candidateList;
            populateSearchResults(response);
        },
        error:function(){
            alert("Connection Error. Network failure or Server unavailable");
        }
    });     
}


function populateSearchResults(response)
{
    str = "";
    if(response.customMessage == "SUCCESS")
    {
        candidateList = response.candidateList;
        if(candidateList.length == 0)
        {
            str += "<tr><td colspan='5'> No Matches found! Please try again !</td></tr>";
        }else
        {
            for(i=0; i<candidateList.length; i++){
                str += "<tr>" ;
                str +=  "<td><a onclick=getCandidateDetail("+i+")>"+candidateList[i].candId+"</a></td>" ;
                str +=  "<td>"+ candidateList[i].candName+"</td><td>"+ candidateList[i].eleTitle+"</td>" ;
                str +=  "<td>"+candidateList[i].constName+","+ candidateList[i].constState +"</td>" ;
                str += "</tr>" ;
            }
        }
    }else{
        str += "<tr><td colspan='5'>"+ response.customMessage +"</td></tr>"; 
    }
    
    showPage('#pageCandidateListView');
    $("#tableCandidateList tbody").html(str);
}

function getCandidateDetail(i)
{
    str  = "";
    str += "<tr><td> Candidate ID </td> <td>:</td>  <td>"+ candidatResults[i].candId + "</td></tr>";
    str += "<tr><td> Candidate Name </td> <td>:</td><td>"+ candidatResults[i].candName + "</td></tr>";
    str += "<tr><td> Candidate Bio </td> <td>:</td> <td>"+ candidatResults[i].candBio + "</td></tr>";
    str += "<tr><td> Constituency </td> <td>:</td>  <td>"+ candidatResults[i].constName + "</td></tr>";
    str += "<tr><td> State </td> <td>:</td>         <td>"+ candidatResults[i].constState + "</td></tr>";
    str += "<tr><td> Enrolled Election</td> <td>:</td> <td>"+ candidatResults[i].eleTitle + "</td></tr>";
    str += "<tr><td> Enrolled Election Description</td> <td>:</td>  <td>"+ candidatResults[i].eleDesc + "</td></tr>";
    
    showPage('#pageCandDetailView');
    $("#tableCandidateDetail").html(str);
    
    //populate hyperlinks
    str = "";
    str += "<button onclick=deleteCandidate("+i+")>Delete </button>"; 
    $("#buttonArea").html(str);
    
}

function deleteCandidate(index)
{
    obj = { "candId":candidatResults[index].candId };
    jsonString =JSON.stringify(obj);
    
    $.ajax({
        type: "POST",
        url: 'http://localhost:8080/mvote/candidates/deleteCandidate',
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data: jsonString,
        success: function(response) {
            populateDeletionResponse(response);
        },
        error:function(){
            alert("Connection Error. Network failure or Server unavailable");
        }
    });     
}

function populateDeletionResponse(response){
    if(response.customMessage == "SUCCESS"){
        alert("Deleted Candidate Successfully!");
    }else{
        alert(response.customMessage);
    }
    
}


function populateHomePage()
{
    showPage("#pageCandidateManagerHome");
     $('#contentAddCandForm').hide();
     $('#contentSearchCandForm').show();
}



function hideAll(){
    $('#pageCandidateManagerHome').hide();
    $('#pageCandidateListView').hide();
    $('#pageCandDetailView').hide();
}

function showPage(pageId){
    hideAll();
    $(pageId).show();
}


function getHomeContents(){
    $.ajax({
        type: "POST",
        url: 'http://localhost:8080/mvote/consts/getAllConsts',
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        //data: jsonString,
        success: function(response) {
            str = "<option value='none'> Select any </option>" ;
            if(response.customMessage == "SUCCESS"){
                list = response.constsList;
                for(var i=0; i<list.length; i++){
                    str += "<option value='"+ list[i].constId+ "'>"+ list[i].constName +", " +list[i].constState;
                    str += "</option>";
                }
            }else{
                str = "<option value='none'> Information Unavailable</option>";
            }   
            constsDropDownContent = str; //to global
            populateHomeConstsDropDown();
        },
        error:function(){
            str = "<option value='none'> Information Unavailable</option>";
            
            constsDropDownContent = str; //to global
            populateHomeConstsDropDown();
        }
    });     

}


function populateHomeConstsDropDown()
{
    showPage("#pageCandidateManagerHome");
     $('#contentAddCandForm').hide();
     $('#contentSearchCandForm').show();
    $('#in_srch_candconst').html(constsDropDownContent);
    $('#in_add_consts').html(constsDropDownContent);
}

function getElectionsByConstituency(constId)
{

    obj = { "constId":constId };
    jsonString =JSON.stringify(obj);
    
    $.ajax({
        type: "POST",
        url: 'http://localhost:8080/mvote/candidates/getElectionsByConst',
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data: jsonString,
        success: function(response) {
            populateElectionDropDown(response);
        },
        error:function(){
            populateElectionDropDownError();
        }
    });     
}


function populateElectionDropDown(response)
{
    str = "<option value='none'> Select any </option>" ;
    if(response.customMessage == "SUCCESS"){
        list = response.electionList;
        for(var i=0; i<list.length; i++){
            str += "<option value='"+ list[i].unitEleId+ "'>"+ list[i].electTitle ;
            str += "</option>";
        }
    }else{
        str = "<option value='none'> Information Unavailable</option>";
    }   
    
    $("#in_add_eles").html(str);
    
}


function populateElectionDropDownError(){
    str = "<option value='none'> Information Unavailable</option>";
    $("#in_add_eles").html(str);
}



</script>
